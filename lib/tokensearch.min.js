!function(t){"use strict";var e=function(t,o){if(!t||0===t.length)throw new Error("Empty collection!");var r=this;if(this.collection=[],t.forEach(function(t){r.collection.push({item:t})}),o=o||{},this.delimiter=o.delimiter||e.defaultOptions.delimiter,this.maxFilterTokenEntries=o.maxFilterTokenEntries||e.defaultOptions.maxFilterTokenEntries,this.defaultThreshold=o.threshold||e.defaultOptions.threshold,this.collectionKeys=o.collectionKeys||e.defaultOptions.collectionKeys,this.searchAlgorithm=o.searchAlgorithm||e.defaultOptions.searchAlgorithm,this.sortAlgorithm=o.sortAlgorithm||e.defaultOptions.sortAlgorithm,this.postprocessAlgorithm=o.postprocessAlgorithm||e.defaultOptions.postprocessAlgorithm,0===this.collectionKeys.length)throw new Error("No collectionKeys defined!");this.collectionDataTokenSize=this.collectionKeys.length,this._prepareSearchTokens()};e.defaultOptions={delimiter:/[\s-_]+/,threshold:.7,maxFilterTokenEntries:5,collectionKeys:[],preprocessCheck:function(){return!0},searchAlgorithm:function(t,e){for(var o=0,r=e.length,i=0;r>i;i++){var n=e[i],s=t.indexOf(n);s>-1&&(o+=n.length<2?1:t===n?6:0===s?2:1)}return o},postprocessAlgorithm:function(t,e,o){var r=1/e,i=[];return t.forEach(function(t){t.score=1-t.score*r,t.maxScore=e,t.score<=o&&i.push(t)}),i},sortAlgorithm:function(t){return t.sort(function(t,e){return t.score!==e.score?t.score-e.score:t.item?t.item.name.localeCompare(e.item.name):0})}},e.prototype._prepareSearchTokens=function(){var t=this;this.collection.forEach(function(e){var o=[];t.collectionKeys.forEach(function(r){e.item[r].trim().toLowerCase().split(t.delimiter).forEach(function(t){o=o.concat(t)})}),e.dataEntryTokens=o.filter(t._onlyUnique)})},e.prototype._onlyUnique=function(t,e,o){return o.indexOf(t)===e},e.prototype.search=function(t,o){o=o||{};for(var r=[],i=o.customThreshold||this.defaultThreshold,n=o.preprocessCheck||e.defaultOptions.preprocessCheck,s=this,c=t.trim().split(this.delimiter).filter(this._onlyUnique),l=0,h=Math.min(c.length,this.maxFilterTokenEntries);h>l;l++)r.push(c[l].toLowerCase());var a=[],f=0;this.collection.forEach(function(t){if(!n||n(t.item)){var e=0;t.dataEntryTokens.forEach(function(t){e+=s.searchAlgorithm(t,r)}),e&&(e>f&&(f=e),a.push({item:t.item,score:e}))}});var u=s.postprocessAlgorithm(a,f,i);return s.sortAlgorithm(u)},"object"==typeof exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Tokensearch=e}(this);